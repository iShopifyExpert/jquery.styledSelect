(function(b){function a(){this.linked_select_box=null;this.options={};this.replacement_container_div=null;this.replacement_options_div=null;this.selected_option_div=null;this.arrow_span=null;this.current_value=null;this.initStyledSelect=function(c,l){this.options=l;this.linked_select_box=b(c);var j=null;if(this.linked_select_box.prop("id")!=null){j=this.linked_select_box.prop("id")+"StyledSelect"}var k=(this.options.full_replacement==true||(this.linked_select_box.attr("data-styled-select-type")!=null&&this.linked_select_box.attr("data-styled-select-type")=="full"));var d=(this.options.multiline==true||(this.linked_select_box.attr("data-styled-select-multiline")!=null&&this.linked_select_box.attr("data-styled-select-multiline")=="true"));this.replacement_container_div=b("<div></div>").addClass("styled_select").prop("id",j);this.selected_option_div=b("<div></div>").addClass("styled_select_option_display");this.arrow_span=b("<span>&nbsp;</span>").addClass("styled_select_arrow").css({backgroundImage:"url("+this.options.image_base+"/small-arrow.png)"});if(l.include_separator_border){var g=this.replacement_container_div.css("border-left-width")+" "+this.replacement_container_div.css("border-left-style")+" "+this.replacement_container_div.css("border-left-color");this.arrow_span.css({borderLeft:g})}this.replacement_container_div.append(this.selected_option_div).append(this.arrow_span);if(this.options.z_index!=null){this.replacement_container_div.css({zIndex:this.options.z_index});this.linked_select_box.css({zIndex:(this.options.z_index+1)})}if(this.options.classes.length>0){for(var h=0;h<this.options.classes.length;h++){this.replacement_container_div.addClass(this.options.classes[h])}}if(k){this.replacement_container_div.addClass("styled-select-full-replacement");this.linked_select_box.addClass("styled-select-full-replacement");if(d){this.replacement_container_div.addClass("styled-select-multiline")}if(this.linked_select_box.attr("tabindex")!=null){this.replacement_container_div.attr("tabindex",this.linked_select_box.attr("tabindex"));this.linked_select_box.attr("tabindex",-1)}else{this.replacement_container_div.attr("tabindex",0)}this.generateOptions()}this.linked_select_box.after(this.replacement_container_div);this.resize();this.linked_select_box.addClass("original_select_now_styled");this.linked_select_box.on("change.styledSelect",b.proxy(this.setCurrentSelectedTextAndValue,this)).on("keyup.styledSelect",b.proxy(this.setCurrentSelectedTextAndValue,this));if(k){this.replacement_container_div.on("click.styledSelect",b.proxy(this.simulateSelectBoxEvent,this)).on("keydown.styledSelect",b.proxy(this.simulateSelectBoxEvent,this)).on("focusout.styledSelect",b.proxy(this.simulateSelectBoxEvent,this));var f=b.data(b(window).get(0),"events");var e=true;if(f!=null){b.each(f,function(i,m){if(i=="resize"&&m[0].namespace=="styledSelect"){e=false}})}if(e){b(window).on("resize.styledSelect",this.resizeOptions);this.resizeOptions()}}this.setCurrentSelectedTextAndValue()};this.resize=function(){this.replacement_container_div.css({width:this.linked_select_box.outerWidth()+"px"});var d={width:(parseInt(this.replacement_container_div.innerWidth()-this.arrow_span.outerWidth()))+"px"};if(this.options.widget_height!=null){var c={height:this.options.widget_height+"px"};this.linked_select_box.css({height:this.options.widget_height+"px",lineHeight:(parseInt(this.options.widget_height)-2)+"px"});d.height=this.options.widget_height+"px";c.lineHeight=(parseInt(this.options.widget_height)-2)+"px";if(b.browser.msie&&parseInt(b.browser.version)<=8){c.lineHeight=this.options.widget_height+"px"}this.replacement_container_div.css(c)}else{d.height=this.linked_select_box.height()+"px"}this.selected_option_div.css(d)};this.generateOptions=function(){this.replacement_options_div=b("<div></div>").addClass("styled_select_options_container");var c=this.linked_select_box.html();c=c.replace(/\<option/gi,'<div class="option"').replace(/\<\/option/gi,"</div").replace(/\<optgroup/gi,'<div class="optgroup"').replace(/\<\/optgroup/gi,"</div");this.replacement_options_div.html(c);this.replacement_options_div.find("div.optgroup").each(function(e,d){b(d).prepend(b("<div></div>").html(b(d).attr("label")).addClass("optgroup_label"))});this.replacement_container_div.append(this.replacement_options_div)};this.triggerIntermediaryChange=function(c,d){if(d!=null&&d.length>0){if(this.replacement_options_div.data("current_option")==null){this.replacement_options_div.data("current_option",c)}this.replacement_options_div.data("new_option",d);if(this.replacement_options_div.hasClass("show")){this.replacement_options_div.find("div.option").removeClass("highlight");d.addClass("highlight")}this.replacement_container_div.find("div.styled_select_option_display").html(d.html());this.current_value=d.attr("value")}};this.triggerValueChange=function(c){this.linked_select_box.val(c).trigger("change");this.replacement_options_div.find("div.option").removeClass("highlight");this.replacement_options_div.removeData("current_option");this.replacement_options_div.removeData("new_option");this.replacement_options_div.removeClass("show")};this.undoIntermediateChanges=function(){if(this.replacement_options_div.hasClass("show")){if(this.replacement_options_div.data("current_option")!=null){this.replacement_container_div.find("div.styled_select_option_display").html(this.replacement_options_div.data("current_option").html());this.current_value=this.replacement_options_div.data("current_option").attr("value")}this.replacement_options_div.find("div.option").removeClass("highlight");this.replacement_options_div.removeData("current_option");this.replacement_options_div.removeData("new_option");this.replacement_options_div.removeClass("show")}};this.simulateSelectBoxEvent=function(e){var d=b(e.target);var g=(b.ui!==undefined?b.ui.keyCode:{DOWN:40,PAGE_DOWN:34,UP:38,PAGE_UP:33,ENTER:13,TAB:9,ESCAPE:27});if(e.type=="keydown"){var f=null;var c=this.replacement_options_div.find('div.option[value="'+this.current_value+'"]');if(e.which==g.ESCAPE){this.undoIntermediateChanges()}else{if(b.inArray(e.which,[g.ENTER,g.TAB])!=-1){if(this.replacement_options_div.data("new_option")!=null){this.triggerValueChange(this.replacement_options_div.data("new_option").attr("value"))}}else{e.preventDefault();if(e.which==g.DOWN){f=c.next("div.option");if(f.length==0){f=c.next("div.optgroup").find("div.option").first()}if(f.length==0){f=c.parent("div.optgroup").next("div.optgroup").find("div.option").first()}if(f.length==0){f=c.parent("div.optgroup").next("div.option")}}else{if(e.which==g.PAGE_DOWN){f=this.replacement_options_div.find("div.option").last()}else{if(e.which==g.UP){f=c.prev("div.option");if(f.length==0){f=c.prev("div.optgroup").find("div.option").last()}if(f.length==0){f=c.parent("div.optgroup").prev("div.optgroup").find("div.option").last()}if(f.length==0){f=c.parent("div.optgroup").prev("div.option")}}else{if(e.which==g.PAGE_UP){f=this.replacement_options_div.find("div.option").first()}else{}}}}this.triggerIntermediaryChange(c,f)}}}else{if(e.type=="focusout"){if(!this.replacement_options_div.is(":hover")){if(this.replacement_options_div.hasClass("show")){if(this.replacement_options_div.data("new_option")!=null){this.triggerValueChange(this.replacement_options_div.data("new_option").attr("value"))}else{this.replacement_options_div.removeClass("show")}}}}else{if(e.type=="click"){if(d.closest("div.styled_select_options_container").length==0){this.replacement_options_div.toggleClass("show")}else{if(d.hasClass("option")){this.triggerValueChange(d.attr("value"))}}}}}};this.setCurrentSelectedTextAndValue=function(c){var f=this.linked_select_box.get(0);var d=this.linked_select_box.find("option");var e=d[f.selectedIndex];if(e!=null){this.replacement_container_div.find("div.styled_select_option_display").html(e.text);this.current_value=e.value}};this.resizeOptions=function(c){var e=b(window).innerHeight();var d=e/2;b("div.styled_select.styled-select-full-replacement").each(function(f,g){b(g).find("div.styled_select_options_container").css({maxHeight:d+"px"})})}}b.fn.styledSelectBox=function(d){var e={image_base:null,classes:[],widget_height:null,include_separator_border:true,z_index:null,full_replacement:false,multiline:false};var c={};if(typeof d=="string"){this.each(function(g,h){var f=b(h).data("styled_select");if(d=="resize"){f.resize()}else{if(d=="update"){f.setCurrentSelectedTextAndValue()}}b(h).data("styled_select",f)})}else{c=b.extend(e,d);if(c.image_base==null){throw'StyledSelectBox widget: no "image_base" option specified.';return this}this.each(function(g,h){var f=new a();f.initStyledSelect(b(h),c);b(h).data("styled_select",f)})}return this}})(jQuery);